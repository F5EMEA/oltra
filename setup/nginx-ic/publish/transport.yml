apiVersion: "cis.f5.com/v1"
kind: TransportServer
metadata:
  name: nginx-plus
  namespace: nginx
  labels:
    f5cr: "true"
spec:
  virtualServerAddress: "10.1.10.40"
  virtualServerPort: 80
  virtualServerName: "nginx-plus"
  mode: standard
  snat: auto   
  pool:
    service: nginx-plus
    servicePort: 80
    monitor:
      type: tcp
      interval: 3
      timeout: 10

---
apiVersion: "cis.f5.com/v1"
kind: TransportServer
metadata:
  name: nginx-plus-ssl
  namespace: nginx
  labels:
    f5cr: "true"
spec:
  virtualServerAddress: "10.1.10.40"
  virtualServerPort: 443
  virtualServerName: "nginx-plus-ssl"
  mode: standard
  snat: auto   
  pool:
    service: nginx-plus
    servicePort: 443
    monitor:
      type: tcp
      interval: 3
      timeout: 10

--- 
apiVersion: cis.f5.com/v1
kind: TLSProfile
metadata:
  labels:
    f5cr: "true"
  name: wildcard-tls
  namespace: nginx
spec:
  hosts:
  - '*.f5demo.local'
  tls:
    clientSSL: /Common/clientssl
    reference: bigip
    termination: edge
---
apiVersion: cis.f5.com/v1
kind: VirtualServer
metadata:
  labels:
    f5cr: "true"
  name: prometheus-vs
  namespace: nginx
spec:
  iRules:
  - /Common/prometheus
  pools:
  - path: /
    service: nginx-infra
    servicePort: 80
  tlsProfileName: wildcard-tls
  virtualServerAddress: 10.1.10.20
  virtualServerName: prometheus-vs